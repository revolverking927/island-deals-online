<!DOCTYPE html>
<html>
<head>
    <title>Available Discounts</title>
    <link rel="stylesheet" href="/styles/styles.css">
</head>
<body>
    <h1 id="title"></h1>
    <table border="1" cellpadding="5" id="discount-table">
        <tr>
            <th>Title</th>
            <th>Reason</th>
            <th>Valid Until</th>
        </tr>
    </table>

<script>
    // Get parish from query string
    const urlParams = new URLSearchParams(window.location.search);
    const parish = urlParams.get('parish');

    document.getElementById("title").innerText =
        `Discounts available in ${parish}`;

    // Fetch discounts from backend
    fetch(`/api/discounts?parish=${parish}`)
        .then(res => res.json())
        .then(data => {
            const table = document.getElementById("discount-table");

            if (data.length === 0) {
                const row = table.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 3;
                cell.innerText = "No discounts available for this parish.";
            } else {
                data.forEach(d => {
                    const row = table.insertRow();
                    row.insertCell(0).innerText = d.title;
                    row.insertCell(1).innerText = d.reason;
                    row.insertCell(2).innerText = new Date(d.valid_until).toLocaleDateString();
                });
            }
        })
        .catch(err => {
            console.error(err);
            alert("Error fetching discounts.");
        });
</script>
</body>
</html>
